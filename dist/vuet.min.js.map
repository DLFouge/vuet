{"version":3,"file":"vuet.min.js","sources":["../src/util.js","../src/vuet-static.js","../src/debug.js","../src/rules/need.js","../src/rules/once.js","../src/rules/reset.js","../src/rules/temp.js","../src/vuet.js","../src/index.js","../src/rules/index.js"],"sourcesContent":["const util = {\n  isObject (obj) {\n    return !!obj && Object.prototype.toString.call(obj) === '[object Object]'\n  },\n  getArgMerge () {\n    let opt = {}\n    const args = arguments\n    if (typeof args[0] === 'string') {\n      opt[args[0]] = args.length > 1 ? args[1] : args[0]\n    } else if (args[0] && util.isObject(args[0])) {\n      opt = args[0]\n    }\n    return opt\n  },\n  isPromise (obj) {\n    return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n  }\n}\n\nexport default util\n","import debug from './debug'\nimport util from './util'\n\nexport let _Vue\n\nexport default function (Vuet) {\n  Object.assign(Vuet, {\n    installed: false,\n    options: {\n      rules: {},\n      module: {\n        reset () {\n          this.state = this.data()\n          return this\n        }\n      }\n    },\n    install (Vue) {\n      if (this.installed) return this\n      this.installed = true\n      _Vue = Vue\n      Object.defineProperty(Vue.prototype, '$vuet', {\n        get () { return this.$root._vuet }\n      })\n      Vue.mixin({\n        beforeCreate () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet = this.$options.vuet\n              this._vuet._init(this)\n            }\n          }\n        },\n        destroyed () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet.destroy(this)\n            }\n          }\n        }\n      })\n      return this\n    },\n    mapModules (opts) {\n      const mixins = Object.keys(opts).map(alias => {\n        const path = opts[alias]\n        return {\n          computed: {\n            [alias]: {\n              get () {\n                debug.assertModule(this.$vuet, path)\n                return this.$vuet.getModule(path)\n              },\n              set (val) {\n                debug.error(`The'${path}'module is not allowed to assign`)\n              }\n            }\n          }\n        }\n      })\n      return {\n        mixins\n      }\n    },\n    mapRules () {\n      const opts = util.getArgMerge.apply(null, arguments)\n      const vueRules = []\n      const addRule = (ruleName, any) => {\n        const rules = Vuet.options.rules[ruleName]\n        if (!util.isObject(rules)) debug.error(`The'${ruleName}'rule does not exist. Please make sure that it executes 'Vuet.rule('${ruleName}', opts)' before all components`)\n        if (typeof any === 'string') {\n          vueRules.push(rules.rule({ path: any }))\n        } else {\n          vueRules.push(rules.rule(any))\n        }\n      }\n      Object.keys(opts).forEach(ruleName => {\n        const any = opts[ruleName]\n        if (Array.isArray(any)) {\n          return any.forEach(item => {\n            addRule(ruleName, item)\n          })\n        }\n        addRule(ruleName, any)\n      })\n      return {\n        mixins: vueRules\n      }\n    },\n    rule () {\n      Vuet.options.rules[arguments[0]] = arguments[1]\n      if (typeof arguments[1].install === 'function') {\n        arguments[1].install(Vuet, _Vue)\n      }\n      return this\n    },\n    callRuleHook (hook, ...arg) {\n      Object.keys(Vuet.options.rules).forEach(k => {\n        if (typeof Vuet.options.rules[k][hook] === 'function') {\n          Vuet.options.rules[k][hook].apply(undefined, arg)\n        }\n      })\n    }\n  })\n}\n","import { _Vue } from './vuet-static'\n\nconst NAME = '__name__'\n\nexport default {\n  error (msg) {\n    throw new Error(`[${NAME}] ${msg}`)\n  },\n  warn (msg) {\n    if (process.env.NODE_ENV !== 'production') {\n      typeof console !== 'undefined' && console.warn(`[${NAME}] ${msg}`)\n    }\n  },\n  assertModule (vuet, path) {\n    if (path in vuet.modules) {\n      return\n    }\n    this.error(`The '${path}' module does not exist`)\n  },\n  assertVue () {\n    if (!_Vue) {\n      this.error('must call Vue.use(Vuet) before creating a store instance')\n    }\n  },\n  assertFetch (vuet, path) {\n    this.assertModule(vuet, path)\n    if (typeof vuet.getModule(path).fetch !== 'function') {\n      this.error(`'${path}' module 'fetch' must be the function type`)\n    }\n  }\n}\n","import debug from '../debug'\n\nexport default {\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertFetch(this.$vuet, path)\n        this.$vuet.getModule(path).fetch()\n      }\n    }\n  }\n}\n","import debug from '../debug'\nimport util from '../util'\n\nconst NAME = '__once__'\n\nexport default {\n  init (vuet) {\n    vuet[NAME] = []\n  },\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertFetch(this.$vuet, path)\n        const vuet = this.$vuet\n        if (vuet[NAME].indexOf(path) > -1) return\n        const back = this.$vuet.getModule(path).fetch()\n        if (util.isPromise(back)) {\n          return back.then(res => {\n            vuet[NAME].push(path)\n          })\n        }\n        vuet[NAME].push(path)\n      }\n    }\n  }\n}\n","import debug from '../debug'\n\nexport default {\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertFetch(this.$vuet, path)\n      },\n      destroyed () {\n        this.$vuet.getModule(path).reset()\n      }\n    }\n  }\n}\n","import debug from '../debug'\n\nexport default {\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertFetch(this.$vuet, path)\n        this.$vuet.getModule(path).fetch()\n      },\n      destroyed () {\n        this.$vuet.getModule(path).reset()\n      }\n    }\n  }\n}\n","import debug from './debug'\nimport util from './util'\nimport { _Vue } from './vuet-static'\nexport default class Vuet {\n  constructor (opts) {\n    debug.assertVue()\n    // debug.assertPromise()\n\n    this.modules = {}\n    this.store = {}\n    this.options = {\n      pathJoin: '/',\n      modules: {}\n    }\n    this.app = null\n    this.vm = new _Vue({\n      data: {\n        modules: this.store\n      }\n    })\n    Object.assign(this.options, opts)\n    Vuet.callRuleHook('init', this)\n    Object.keys(this.options.modules).forEach(k => {\n      this.addModules(k, this.options.modules[k])\n    })\n  }\n  _init (app) {\n    this.app = app\n  }\n  addModules (path, modules) {\n    if (util.isObject(modules.modules)) {\n      Object.keys(modules.modules).forEach(k => {\n        this.addModules(`${path}${this.options.pathJoin}${k}`, modules.modules[k])\n      })\n    }\n    if (typeof modules.data !== 'function') return this\n    const vuet = this\n    const opts = { ...Vuet.options.module, ...modules }\n    _Vue.set(vuet.store, path, opts.data())\n    vuet.modules[path] = opts\n    Vuet.callRuleHook('addModule', this, path)\n    Object.defineProperty(opts, 'vuet', {\n      get: () => (vuet)\n    })\n    Object.defineProperty(opts, 'app', {\n      get: () => (vuet.app)\n    })\n    Object.defineProperty(opts, 'state', {\n      get () {\n        return vuet.store[path]\n      },\n      set (val) {\n        vuet.store[path] = val\n      }\n    })\n    Object.keys(opts).forEach(k => {\n      if (typeof opts[k] === 'function') {\n        const native = opts[k]\n        opts[k] = function proxy () {\n          return native.apply(vuet.modules[path], arguments)\n        }\n      }\n    })\n    if (util.isObject(opts.state)) {\n      Object.keys(opts.state).forEach(k => {\n        if (k in opts) {\n          return debug.warn(`'${path}' the '${k}' already exists on the object`)\n        }\n        Object.defineProperty(opts, k, {\n          get () {\n            return vuet.store[path][k]\n          },\n          set (val) {\n            vuet.store[path][k] = val\n          }\n        })\n      })\n    }\n    return this\n  }\n  getModule (path) {\n    debug.assertModule(this, path)\n    return this.modules[path]\n  }\n  getState (path) {\n    debug.assertModule(this, path)\n    return this.modules[path].state\n  }\n  destroy () {\n    this.vm.$destroy()\n    Vuet.callRuleHook('destroy', this)\n  }\n}\n","import rules from './rules/index'\nimport VuetStatic from './vuet-static'\nimport Vuet from './vuet'\n\nVuetStatic(Vuet)\nrules(Vuet)\nexport const mapRules = Vuet.mapRules.bind(Vuet)\nexport const mapModules = Vuet.mapModules.bind(Vuet)\n\nexport default Vuet\n","import need from './need'\nimport once from './once'\nimport reset from './reset'\nimport temp from './temp'\n\nexport default function install (Vuet) {\n  Vuet\n    .rule('need', need)\n    .rule('once', once)\n    .rule('temp', temp)\n    .rule('reset', reset)\n}\n"],"names":["util","obj","Object","prototype","toString","call","opt","args","arguments","length","isObject","then","_Vue","msg","Error","vuet","path","modules","error","assertModule","getModule","fetch","assertFetch","this","$vuet","indexOf","back","isPromise","push","reset","Vuet","opts","assertVue","store","options","app","vm","assign","callRuleHook","keys","forEach","addModules","k","_this","_this2","pathJoin","data","module","set","defineProperty","val","native","apply","state","debug","warn","$destroy","Vue","installed","$root","_vuet","mixin","$options","_init","destroy","map","alias","getArgMerge","vueRules","addRule","ruleName","any","rules","rule","Array","isArray","item","install","hook","arg","undefined","need","once","temp","mapRules","bind","mapModules"],"mappings":"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"}