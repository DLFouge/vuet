{"version":3,"file":"vuet-store.js","sources":["../../../src/vuet-static.js","../../../src/debug.js","../src/index.js"],"sourcesContent":["import debug from './debug'\nimport util from './util'\n\nexport let _Vue\n\nexport default function (Vuet) {\n  Object.assign(Vuet, {\n    installed: false,\n    options: {\n      rules: {},\n      module: {\n        reset () {\n          this.state = this.data()\n          return this\n        }\n      }\n    },\n    install (Vue) {\n      if (this.installed) return this\n      this.installed = true\n      _Vue = Vue\n      Object.defineProperty(Vue.prototype, '$vuet', {\n        get () { return this.$root._vuet }\n      })\n      Vue.mixin({\n        beforeCreate () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet = this.$options.vuet\n              this._vuet._init(this)\n            }\n          }\n        },\n        destroyed () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet.destroy(this)\n            }\n          }\n        }\n      })\n      return this\n    },\n    mapModules (opts) {\n      const mixins = Object.keys(opts).map(alias => {\n        const path = opts[alias]\n        return {\n          computed: {\n            [alias]: {\n              get () {\n                debug.assertModule(this.$vuet, path)\n                return this.$vuet.getModule(path)\n              },\n              set (val) {\n                debug.error(`The'${path}'module is not allowed to assign`)\n              }\n            }\n          }\n        }\n      })\n      return {\n        mixins\n      }\n    },\n    mapRules () {\n      const opts = util.getArgMerge.apply(null, arguments)\n      const vueRules = []\n      const addRule = (ruleName, any) => {\n        const rules = Vuet.options.rules[ruleName]\n        if (!util.isObject(rules)) debug.error(`The'${ruleName}'rule does not exist. Please make sure that it executes 'Vuet.rule('${ruleName}', opts)' before all components`)\n        if (typeof any === 'string') {\n          vueRules.push(rules.rule({ path: any }))\n        } else {\n          vueRules.push(rules.rule(any))\n        }\n      }\n      Object.keys(opts).forEach(ruleName => {\n        const any = opts[ruleName]\n        if (Array.isArray(any)) {\n          return any.forEach(item => {\n            addRule(ruleName, item)\n          })\n        }\n        addRule(ruleName, any)\n      })\n      return {\n        mixins: vueRules\n      }\n    },\n    rule () {\n      Vuet.options.rules[arguments[0]] = arguments[1]\n      if (typeof arguments[1].install === 'function') {\n        arguments[1].install(Vuet, _Vue)\n      }\n      return this\n    },\n    callRuleHook (hook, ...arg) {\n      Object.keys(Vuet.options.rules).forEach(k => {\n        if (typeof Vuet.options.rules[k][hook] === 'function') {\n          Vuet.options.rules[k][hook].apply(undefined, arg)\n        }\n      })\n    }\n  })\n}\n","import { _Vue } from './vuet-static'\n\nconst NAME = '__name__'\n\nexport default {\n  error (msg) {\n    throw new Error(`[${NAME}] ${msg}`)\n  },\n  warn (msg) {\n    if (process.env.NODE_ENV !== 'production') {\n      typeof console !== 'undefined' && console.warn(`[${NAME}] ${msg}`)\n    }\n  },\n  assertModule (vuet, path) {\n    if (path in vuet.modules) {\n      return\n    }\n    this.error(`The '${path}' module does not exist`)\n  },\n  assertVue () {\n    if (!_Vue) {\n      this.error('must call Vue.use(Vuet) before creating a store instance')\n    }\n  },\n  assertFetch (vuet, path) {\n    this.assertModule(vuet, path)\n    if (typeof vuet.getModule(path).fetch !== 'function') {\n      this.error(`'${path}' module 'fetch' must be the function type`)\n    }\n  }\n}\n","import debug from '../../../src/debug'\n\nconst getName = (path) => {\n  return `__vuet_store_${path}__`\n}\n\nconst setItem = (path, data) => {\n  setTimeout(() => {\n    localStorage.setItem(getName(path), JSON.stringify(data))\n  }, 0)\n}\n\nexport default {\n  addModule (vuet, path) {\n    const store = JSON.parse(localStorage.getItem(getName(path)))\n    if (store) {\n      vuet.getModule(path).state = store\n    }\n  },\n  rule ({ path }) {\n    return {\n      created () {\n        debug.assertModule(this.$vuet, path)\n        setItem(path, this.$vuet.getModule(path).state)\n        this[getName(path)] = this.$vuet.app.$watch(function () {\n          return this.$vuet.getModule(path).state\n        }, (newVal) => {\n          setItem(path, newVal)\n        }, {\n          deep: true\n        })\n      },\n      destroyed () {\n        this[getName(path)].unwatch()\n        delete this[getName(path)]\n      }\n    }\n  }\n}\n"],"names":["_Vue","NAME","msg","Error","process","console","warn","vuet","path","modules","error","assertModule","getModule","fetch","getName","setItem","data","JSON","stringify","store","parse","localStorage","getItem","state","$vuet","app","$watch","newVal","unwatch"],"mappings":";;;;;;AAGO,IAAIA,aAAJ,CAEP;;ACHA,IAAMC,OAAO,YAAb;;AAEA,YAAe;OAAA,iBACNC,GADM,EACD;UACJ,IAAIC,KAAJ,OAAcF,IAAd,UAAuBC,GAAvB,CAAN;GAFW;MAAA,gBAIPA,GAJO,EAIF;IACLE,AAAJ,AAA2C;aAClCC,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,IAAR,OAAiBL,IAAjB,UAA0BC,GAA1B,CAAlC;;GANS;cAAA,wBASCK,IATD,EASOC,IATP,EASa;QACpBA,QAAQD,KAAKE,OAAjB,EAA0B;;;SAGrBC,KAAL,YAAmBF,IAAnB;GAbW;WAAA,uBAeA;QACP,CAACR,IAAL,EAAW;WACJU,KAAL,CAAW,0DAAX;;GAjBS;aAAA,uBAoBAH,IApBA,EAoBMC,IApBN,EAoBY;SAClBG,YAAL,CAAkBJ,IAAlB,EAAwBC,IAAxB;QACI,OAAOD,KAAKK,SAAL,CAAeJ,IAAf,EAAqBK,KAA5B,KAAsC,UAA1C,EAAsD;WAC/CH,KAAL,QAAeF,IAAf;;;CAvBN;;ACFA,IAAMM,UAAU,SAAVA,OAAU,CAACN,IAAD,EAAU;2BACDA,IAAvB;CADF;;AAIA,IAAMO,UAAU,SAAVA,OAAU,CAACP,IAAD,EAAOQ,IAAP,EAAgB;aACnB,YAAM;iBACFD,OAAb,CAAqBD,QAAQN,IAAR,CAArB,EAAoCS,KAAKC,SAAL,CAAeF,IAAf,CAApC;GADF,EAEG,CAFH;CADF;;AAMA,YAAe;WAAA,qBACFT,IADE,EACIC,IADJ,EACU;QACfW,QAAQF,KAAKG,KAAL,CAAWC,aAAaC,OAAb,CAAqBR,QAAQN,IAAR,CAArB,CAAX,CAAd;QACIW,KAAJ,EAAW;WACJP,SAAL,CAAeJ,IAAf,EAAqBe,KAArB,GAA6BJ,KAA7B;;GAJS;MAAA,sBAOG;QAARX,IAAQ,QAARA,IAAQ;;WACP;aAAA,qBACM;cACHG,YAAN,CAAmB,KAAKa,KAAxB,EAA+BhB,IAA/B;gBACQA,IAAR,EAAc,KAAKgB,KAAL,CAAWZ,SAAX,CAAqBJ,IAArB,EAA2Be,KAAzC;aACKT,QAAQN,IAAR,CAAL,IAAsB,KAAKgB,KAAL,CAAWC,GAAX,CAAeC,MAAf,CAAsB,YAAY;iBAC/C,KAAKF,KAAL,CAAWZ,SAAX,CAAqBJ,IAArB,EAA2Be,KAAlC;SADoB,EAEnB,UAACI,MAAD,EAAY;kBACLnB,IAAR,EAAcmB,MAAd;SAHoB,EAInB;gBACK;SALc,CAAtB;OAJG;eAAA,uBAYQ;aACNb,QAAQN,IAAR,CAAL,EAAoBoB,OAApB;eACO,KAAKd,QAAQN,IAAR,CAAL,CAAP;;KAdJ;;CARJ;;;;;;"}