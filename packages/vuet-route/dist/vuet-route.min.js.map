{"version":3,"file":"vuet-route.min.js","sources":["../src/index.js","../../../src/util.js","../../../src/debug.js"],"sourcesContent":["import debug from '../../../src/debug'\nimport util from '../../../src/util'\n\nconst NAME = '__route__'\n\nfunction isWatch (vuet, path, route) {\n  const vtm = vuet.getModule(path)\n  let watch = ['fullPath']\n  if (vtm.route.watch) {\n    watch = vtm.route.watch\n  }\n  watch = Array.isArray(watch) ? watch : [watch]\n  const oldWatch = vuet[NAME][path] // old\n  vuet[NAME][path] = [] // new\n  watch.forEach(k => {\n    let data = route\n    k.split('.').forEach(chlidKey => {\n      data = data[chlidKey]\n    })\n    vuet[NAME][path].push(JSON.stringify(data))\n  })\n  return oldWatch.join() !== vuet[NAME][path].join()\n}\n\nexport default {\n  init (vuet) {\n    vuet[NAME] = {}\n  },\n  addModule (vuet, path) {\n    vuet[NAME][path] = []\n    if (!util.isObject(vuet.getModule(path).route)) {\n      vuet.getModule(path).route = {}\n    }\n  },\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertModule(this.$vuet, path)\n        if (!this.$route) {\n          debug.error(`The 'vue-router' module is not installed`)\n        }\n        const vtm = this.$vuet.getModule(path)\n        if (!util.isObject(vtm.state)) {\n          debug.error(`'${path}' module state must be the object type`)\n        }\n        if (typeof vtm.fetch !== 'function') {\n          debug.error(`'${path}' module 'fetch' must be the function type`)\n        }\n        if (isWatch(this.$vuet, path, this.$route)) {\n          vtm.reset()\n          vtm.state.__routeLoaded__ = true\n          return vtm.fetch(vtm)\n        }\n        if (vtm.route.once !== true || !vtm.state.__routeLoaded__) { // default\n          vtm.state.__routeLoaded__ = true\n          return vtm.fetch(vtm)\n        }\n      },\n      watch: {\n        $route: {\n          deep: true,\n          handler (to, from) {\n            const vtm = this.$vuet.getModule(path)\n            if (isWatch(this.$vuet, path, to)) {\n              vtm.reset()\n              vtm.state.__routeLoaded__ = true\n              vtm.fetch(vtm)\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","const util = {\n  isObject (obj) {\n    return !!obj && Object.prototype.toString.call(obj) === '[object Object]'\n  },\n  getArgMerge () {\n    let opt = {}\n    const args = arguments\n    if (typeof args[0] === 'string') {\n      opt[args[0]] = args.length > 1 ? args[1] : args[0]\n    } else if (args[0] && util.isObject(args[0])) {\n      opt = args[0]\n    }\n    return opt\n  },\n  isPromise (obj) {\n    return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n  }\n}\n\nexport default util\n","import { _Vue } from './vuet-static'\n\nconst NAME = '__name__'\n\nexport default {\n  error (msg) {\n    throw new Error(`[${NAME}] ${msg}`)\n  },\n  warn (msg) {\n    if (process.env.NODE_ENV !== 'production') {\n      typeof console !== 'undefined' && console.warn(`[${NAME}] ${msg}`)\n    }\n  },\n  assertModule (vuet, path) {\n    if (path in vuet.modules) {\n      return\n    }\n    this.error(`The '${path}' module does not exist`)\n  },\n  assertVue () {\n    if (!_Vue) {\n      this.error('must call Vue.use(Vuet) before creating a store instance')\n    }\n  },\n  assertFetch (vuet, path) {\n    this.assertModule(vuet, path)\n    if (typeof vuet.getModule(path).fetch !== 'function') {\n      this.error(`The '${path}' module 'fetch' method does not exist`)\n    }\n  }\n}\n"],"names":["isWatch","vuet","path","route","vtm","getModule","watch","Array","isArray","oldWatch","NAME","forEach","data","split","chlidKey","push","JSON","stringify","join","util","obj","Object","prototype","toString","call","opt","args","arguments","length","isObject","then","msg","Error","modules","error","assertModule","fetch","this","$vuet","$route","state","reset","__routeLoaded__","once","to","from"],"mappings":"wMAKA,SAASA,GAASC,EAAMC,EAAMC,MACtBC,GAAMH,EAAKI,UAAUH,GACvBI,GAAS,WACTF,GAAID,MAAMG,UACJF,EAAID,MAAMG,SAEZC,MAAMC,QAAQF,GAASA,GAASA,MAClCG,GAAWR,EAAKS,GAAMR,YACvBQ,GAAMR,QACLS,QAAQ,eACRC,GAAOT,IACTU,MAAM,KAAKF,QAAQ,cACZC,EAAKE,OAETJ,GAAMR,GAAMa,KAAKC,KAAKC,UAAUL,MAEhCH,EAASS,SAAWjB,EAAKS,GAAMR,GAAMgB,uNCrBxCC,qBACMC,WACCA,GAA+C,oBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,8BAG3CK,MACEC,EAAOC,gBACU,gBAAZD,GAAK,KACVA,EAAK,IAAMA,EAAKE,OAAS,EAAIF,EAAK,GAAKA,EAAK,GACvCA,EAAK,IAAMP,EAAKU,SAASH,EAAK,QACjCA,EAAK,IAEND,sBAEEL,WACAA,IAAuB,qBAARA,gBAAAA,KAAmC,kBAARA,KAA2C,kBAAbA,GAAIU,yBCVhFC,QACC,IAAIC,uBAAmBD,kBAEzBA,2BAKQ9B,EAAMC,GACdA,IAAQD,GAAKgC,cAGZC,cAAchC,wDAIZgC,MAAM,kFAGFjC,EAAMC,QACZiC,aAAalC,EAAMC,GACkB,kBAA/BD,GAAKI,UAAUH,GAAMkC,YACzBF,cAAchC,8CFxBnBQ,EAAO,6BAsBLT,KACCS,0BAEIT,EAAMC,KACVQ,GAAMR,MACNiB,EAAKU,SAAS5B,EAAKI,UAAUH,GAAMC,WACjCE,UAAUH,GAAMC,+BAGjBD,KAAAA,sCAGIiC,aAAaE,KAAKC,MAAOpC,GAC1BmC,KAAKE,UACFL,qDAEF9B,GAAMiC,KAAKC,MAAMjC,UAAUH,SAC5BiB,GAAKU,SAASzB,EAAIoC,UACfN,UAAUhC,4CAEO,kBAAdE,GAAIgC,SACPF,UAAUhC,gDAEdF,EAAQqC,KAAKC,MAAOpC,EAAMmC,KAAKE,WAC7BE,UACAD,MAAME,iBAAkB,EACrBtC,EAAIgC,MAAMhC,KAEI,IAAnBA,EAAID,MAAMwC,MAAkBvC,EAAIoC,MAAME,0BACpCF,MAAME,iBAAkB,EACrBtC,EAAIgC,MAAMhC,0BAKX,mBACGwC,EAAIC,MACLzC,GAAMiC,KAAKC,MAAMjC,UAAUH,EAC7BF,GAAQqC,KAAKC,MAAOpC,EAAM0C,OACxBH,UACAD,MAAME,iBAAkB,IACxBN,MAAMhC"}