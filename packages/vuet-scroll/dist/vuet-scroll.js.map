{"version":3,"file":"vuet-scroll.js","sources":["../../../src/util.js","../../../src/vuet-static.js","../../../src/debug.js","../src/index.js"],"sourcesContent":["const util = {\n  isObject (obj) {\n    return !!obj && Object.prototype.toString.call(obj) === '[object Object]'\n  },\n  getArgMerge () {\n    let opt = {}\n    const args = arguments\n    if (typeof args[0] === 'string') {\n      opt[args[0]] = args.length > 1 ? args[1] : args[0]\n    } else if (args[0] && util.isObject(args[0])) {\n      opt = args[0]\n    }\n    return opt\n  },\n  isPromise (obj) {\n    return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n  }\n}\n\nexport default util\n","import debug from './debug'\nimport util from './util'\n\nexport let _Vue\n\nexport default function (Vuet) {\n  Object.assign(Vuet, {\n    installed: false,\n    options: {\n      rules: {}\n    },\n    install (Vue) {\n      if (this.installed) return this\n      this.installed = true\n      _Vue = Vue\n      Object.defineProperty(Vue.prototype, '$vuet', {\n        get () { return this.$root._vuet }\n      })\n      Vue.mixin({\n        beforeCreate () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet = this.$options.vuet\n              this._vuet._init(this)\n            }\n          }\n        },\n        destroyed () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            if (this.$options.vuet instanceof Vuet) {\n              this._vuet.destroy(this)\n            }\n          }\n        }\n      })\n      return this\n    },\n    mapModules (opts) {\n      const mixins = Object.keys(opts).map(alias => {\n        const path = opts[alias]\n        return {\n          computed: {\n            [alias]: {\n              get () {\n                debug.assertModule(this.$vuet, path)\n                return this.$vuet.getModule(path)\n              },\n              set (val) {\n                debug.error(`The'${path}'module is not allowed to assign`)\n              }\n            }\n          }\n        }\n      })\n      return {\n        mixins\n      }\n    },\n    mapRules () {\n      const opts = util.getArgMerge.apply(null, arguments)\n      const vueRules = []\n      const addRule = (ruleName, any) => {\n        const rules = Vuet.options.rules[ruleName]\n        if (!util.isObject(rules)) debug.error(`The'${ruleName}'rule does not exist. Please make sure that it executes 'Vuet.rule('${ruleName}', opts)' before all components`)\n        if (typeof any === 'string') {\n          vueRules.push(rules.rule({ path: any }))\n        } else {\n          vueRules.push(rules.rule(any))\n        }\n      }\n      Object.keys(opts).forEach(ruleName => {\n        const any = opts[ruleName]\n        if (Array.isArray(any)) {\n          return any.forEach(item => {\n            addRule(ruleName, item)\n          })\n        }\n        addRule(ruleName, any)\n      })\n      return {\n        mixins: vueRules\n      }\n    },\n    rule () {\n      Vuet.options.rules[arguments[0]] = arguments[1]\n      if (typeof arguments[1].install === 'function') {\n        arguments[1].install(Vuet, _Vue)\n      }\n      return this\n    },\n    callRuleHook (hook, ...arg) {\n      Object.keys(Vuet.options.rules).forEach(k => {\n        if (typeof Vuet.options.rules[k][hook] === 'function') {\n          Vuet.options.rules[k][hook].apply(undefined, arg)\n        }\n      })\n    }\n  })\n}\n","import { _Vue } from './vuet-static'\n\nconst NAME = '__name__'\n\nexport default {\n  error (msg) {\n    throw new Error(`[${NAME}] ${msg}`)\n  },\n  warn (msg) {\n    if (process.env.NODE_ENV !== 'production') {\n      typeof console !== 'undefined' && console.warn(`[${NAME}] ${msg}`)\n    }\n  },\n  assertModule (vuet, path) {\n    if (path in vuet.modules) {\n      return\n    }\n    this.error(`The '${path}' module does not exist`)\n  },\n  assertVue () {\n    if (!_Vue) {\n      this.error('must call Vue.use(Vuet) before creating a store instance')\n    }\n  },\n  assertFetch (vuet, path) {\n    this.assertModule(vuet, path)\n    if (typeof vuet.getModule(path).fetch !== 'function') {\n      this.error(`'${path}' module 'fetch' must be the function type`)\n    }\n  }\n}\n","import debug from '../../../src/debug'\nimport util from '../../../src/util'\n\nlet _Vue\nconst _self = '__vuetScrollSelf__'\nconst _window = '__vuetScrollWindow__'\n\nclass VuetScroll {\n  constructor (opts) {\n    this.timer = {}\n    this.setOption(opts)\n    this.scrollTo()\n    this.subScroll()\n  }\n  update (opts) {\n    this.setOption(opts)\n    const key = `timer-${this.path}-${this.name}`\n    clearTimeout(this.timer[key])\n    this.timer[key] = setTimeout(() => {\n      this.scrollTo()\n      delete this.timer[key]\n    }, 10)\n  }\n  destroy () {\n    this.app.removeEventListener('scroll', this.subScrolling, false)\n  }\n  setOption (opt) {\n    this.app = opt.app\n    this.path = opt.path\n    this.name = opt.name || ''\n    this.store = opt.store || { x: 0, y: 0 }\n    this.scrolls = opt.scrolls || createScroll(opt)\n    function createScroll (opt) {\n      if (!opt.store.$scroll) {\n        _Vue.set(opt.store, '$scroll', {})\n      }\n      if (!opt.store.$scroll[opt.name]) {\n        _Vue.set(opt.store.$scroll, opt.name, { x: 0, y: 0 })\n      }\n\n      return opt.store.$scroll[opt.name]\n    }\n  }\n  scrollTo () {\n    const { app, scrolls } = this\n    if ('scrollTop' in app && app !== window) {\n      app.scrollLeft = scrolls.x\n      app.scrollTop = scrolls.y\n    } else {\n      app.scrollTo(scrolls.x, scrolls.y)\n    }\n  }\n  subScroll () {\n    const { app } = this\n    const newScrolls = { x: 0, y: 0 }\n    this.subScrolling = (event) => {\n      if (app === window) {\n        newScrolls.x = window.pageXOffset\n        newScrolls.y = window.pageYOffset\n      } else {\n        const { scrollTop, scrollLeft, pageXOffset, pageYOffset } = event.target\n        newScrolls.x = scrollLeft || pageYOffset || scrollLeft\n        newScrolls.y = scrollTop || pageXOffset || scrollTop\n      }\n      Object.assign(this.scrolls, newScrolls)\n    }\n    app.addEventListener('scroll', this.subScrolling, false)\n  }\n}\n\nfunction isSelf (modifiers) {\n  return !!(modifiers.window !== true || modifiers.self)\n}\n\nfunction isWindow (modifiers) {\n  return !!(modifiers.window)\n}\n\nconst directive = {\n  inserted (el, { modifiers, value }, vnode) {\n    if (typeof value.path !== 'string') return debug.error('path is imperative parameter and is string type')\n    if (value.path === 'window') return debug.error('name cannot be the window name')\n    const store = vnode.context.$vuet.getState(value.path)\n    if (!util.isObject(store)) return debug.error(`'${value.path}' The module is not an object`)\n    if (isSelf(modifiers)) {\n      if (typeof value.name !== 'string') return debug.error('name is imperative parameter and is string type')\n      el[_self] = new VuetScroll({\n        app: el,\n        path: value.path,\n        name: value.name,\n        store,\n        scrolls: value.self\n      })\n    }\n    if (isWindow(modifiers)) {\n      el[_window] = new VuetScroll({\n        app: window,\n        path: value.path,\n        name: 'window',\n        store,\n        scrolls: value.window\n      })\n    }\n  },\n  componentUpdated (el, { modifiers, value }, vnode) {\n    const store = vnode.context.$vuet.getState(value.path)\n    if (!util.isObject(store)) return debug.error(`'${value.path}' The module is not an object`)\n    if (isSelf(modifiers)) {\n      el[_self].update({\n        app: el,\n        path: value.path,\n        name: value.name,\n        store,\n        scrolls: value.self\n      })\n    }\n    if (isWindow(modifiers)) {\n      el[_window].update({\n        app: window,\n        path: value.path,\n        name: 'window',\n        store,\n        scrolls: value.window || null\n      })\n    }\n  },\n  unbind (el, { modifiers }) {\n    if (isSelf(modifiers)) {\n      el[_self].destroy()\n      delete el[_self]\n    }\n    if (isWindow(modifiers)) {\n      el[_window].destroy()\n      delete el[_window]\n    }\n  }\n}\n\nexport default {\n  install (Vue) {\n    _Vue = Vue\n    Vue.directive('vuet-scroll', directive)\n  }\n}\n"],"names":["util","obj","Object","prototype","toString","call","opt","args","arguments","length","isObject","then","_Vue","NAME","msg","Error","process","console","warn","vuet","path","modules","error","assertModule","getModule","fetch","_self","_window","VuetScroll","opts","timer","setOption","scrollTo","subScroll","key","name","setTimeout","app","removeEventListener","subScrolling","store","x","y","scrolls","createScroll","$scroll","set","window","scrollLeft","scrollTop","newScrolls","event","pageXOffset","pageYOffset","target","assign","addEventListener","isSelf","modifiers","self","isWindow","directive","el","vnode","value","debug","context","$vuet","getState","update","destroy","Vue"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,OAAO;UAAA,oBACDC,GADC,EACI;WACN,CAAC,CAACA,GAAF,IAASC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,iBAAxD;GAFS;aAAA,yBAII;QACTK,MAAM,EAAV;QACMC,OAAOC,SAAb;QACI,OAAOD,KAAK,CAAL,CAAP,KAAmB,QAAvB,EAAiC;UAC3BA,KAAK,CAAL,CAAJ,IAAeA,KAAKE,MAAL,GAAc,CAAd,GAAkBF,KAAK,CAAL,CAAlB,GAA4BA,KAAK,CAAL,CAA3C;KADF,MAEO,IAAIA,KAAK,CAAL,KAAWP,KAAKU,QAAL,CAAcH,KAAK,CAAL,CAAd,CAAf,EAAuC;YACtCA,KAAK,CAAL,CAAN;;WAEKD,GAAP;GAZS;WAAA,qBAcAL,GAdA,EAcK;WACP,CAAC,CAACA,GAAF,KAAU,QAAOA,GAAP,yCAAOA,GAAP,OAAe,QAAf,IAA2B,OAAOA,GAAP,KAAe,UAApD,KAAmE,OAAOA,IAAIU,IAAX,KAAoB,UAA9F;;CAfJ,CAmBA;;AChBO,IAAIC,eAAJ,CAEP;;ACHA,IAAMC,OAAO,aAAb;;AAEA,YAAe;OAAA,iBACNC,GADM,EACD;UACJ,IAAIC,KAAJ,OAAcF,IAAd,UAAuBC,GAAvB,CAAN;GAFW;MAAA,gBAIPA,GAJO,EAIF;IACLE,AAAJ,AAA2C;aAClCC,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,IAAR,OAAiBL,IAAjB,UAA0BC,GAA1B,CAAlC;;GANS;cAAA,wBASCK,IATD,EASOC,IATP,EASa;QACpBA,QAAQD,KAAKE,OAAjB,EAA0B;;;SAGrBC,KAAL,YAAmBF,IAAnB;GAbW;WAAA,uBAeA;QACP,CAACR,MAAL,EAAW;WACJU,KAAL,CAAW,0DAAX;;GAjBS;aAAA,uBAoBAH,IApBA,EAoBMC,IApBN,EAoBY;SAClBG,YAAL,CAAkBJ,IAAlB,EAAwBC,IAAxB;QACI,OAAOD,KAAKK,SAAL,CAAeJ,IAAf,EAAqBK,KAA5B,KAAsC,UAA1C,EAAsD;WAC/CH,KAAL,QAAeF,IAAf;;;CAvBN;;ACDA,IAAIR,aAAJ;AACA,IAAMc,QAAQ,oBAAd;AACA,IAAMC,UAAU,sBAAhB;;IAEMC;sBACSC,IAAb,EAAmB;;;SACZC,KAAL,GAAa,EAAb;SACKC,SAAL,CAAeF,IAAf;SACKG,QAAL;SACKC,SAAL;;;;;2BAEMJ,MAAM;;;WACPE,SAAL,CAAeF,IAAf;UACMK,iBAAe,KAAKd,IAApB,SAA4B,KAAKe,IAAvC;mBACa,KAAKL,KAAL,CAAWI,GAAX,CAAb;WACKJ,KAAL,CAAWI,GAAX,IAAkBE,WAAW,YAAM;cAC5BJ,QAAL;eACO,MAAKF,KAAL,CAAWI,GAAX,CAAP;OAFgB,EAGf,EAHe,CAAlB;;;;8BAKS;WACJG,GAAL,CAASC,mBAAT,CAA6B,QAA7B,EAAuC,KAAKC,YAA5C,EAA0D,KAA1D;;;;8BAESjC,KAAK;WACT+B,GAAL,GAAW/B,IAAI+B,GAAf;WACKjB,IAAL,GAAYd,IAAIc,IAAhB;WACKe,IAAL,GAAY7B,IAAI6B,IAAJ,IAAY,EAAxB;WACKK,KAAL,GAAalC,IAAIkC,KAAJ,IAAa,EAAEC,GAAG,CAAL,EAAQC,GAAG,CAAX,EAA1B;WACKC,OAAL,GAAerC,IAAIqC,OAAJ,IAAeC,aAAatC,GAAb,CAA9B;eACSsC,YAAT,CAAuBtC,GAAvB,EAA4B;YACtB,CAACA,IAAIkC,KAAJ,CAAUK,OAAf,EAAwB;eACjBC,GAAL,CAASxC,IAAIkC,KAAb,EAAoB,SAApB,EAA+B,EAA/B;;YAEE,CAAClC,IAAIkC,KAAJ,CAAUK,OAAV,CAAkBvC,IAAI6B,IAAtB,CAAL,EAAkC;eAC3BW,GAAL,CAASxC,IAAIkC,KAAJ,CAAUK,OAAnB,EAA4BvC,IAAI6B,IAAhC,EAAsC,EAAEM,GAAG,CAAL,EAAQC,GAAG,CAAX,EAAtC;;;eAGKpC,IAAIkC,KAAJ,CAAUK,OAAV,CAAkBvC,IAAI6B,IAAtB,CAAP;;;;;+BAGQ;UACFE,GADE,GACe,IADf,CACFA,GADE;UACGM,OADH,GACe,IADf,CACGA,OADH;;UAEN,eAAeN,GAAf,IAAsBA,QAAQU,MAAlC,EAA0C;YACpCC,UAAJ,GAAiBL,QAAQF,CAAzB;YACIQ,SAAJ,GAAgBN,QAAQD,CAAxB;OAFF,MAGO;YACDV,QAAJ,CAAaW,QAAQF,CAArB,EAAwBE,QAAQD,CAAhC;;;;;gCAGS;;;UACHL,GADG,GACK,IADL,CACHA,GADG;;UAELa,aAAa,EAAET,GAAG,CAAL,EAAQC,GAAG,CAAX,EAAnB;WACKH,YAAL,GAAoB,UAACY,KAAD,EAAW;YACzBd,QAAQU,MAAZ,EAAoB;qBACPN,CAAX,GAAeM,OAAOK,WAAtB;qBACWV,CAAX,GAAeK,OAAOM,WAAtB;SAFF,MAGO;8BACuDF,MAAMG,MAD7D;cACGL,SADH,iBACGA,SADH;cACcD,UADd,iBACcA,UADd;cAC0BI,WAD1B,iBAC0BA,WAD1B;cACuCC,WADvC,iBACuCA,WADvC;;qBAEMZ,CAAX,GAAeO,cAAcK,WAAd,IAA6BL,UAA5C;qBACWN,CAAX,GAAeO,aAAaG,WAAb,IAA4BH,SAA3C;;eAEKM,MAAP,CAAc,OAAKZ,OAAnB,EAA4BO,UAA5B;OATF;UAWIM,gBAAJ,CAAqB,QAArB,EAA+B,KAAKjB,YAApC,EAAkD,KAAlD;;;;;;AAIJ,SAASkB,MAAT,CAAiBC,SAAjB,EAA4B;SACnB,CAAC,EAAEA,UAAUX,MAAV,KAAqB,IAArB,IAA6BW,UAAUC,IAAzC,CAAR;;;AAGF,SAASC,QAAT,CAAmBF,SAAnB,EAA8B;SACrB,CAAC,CAAEA,UAAUX,MAApB;;;AAGF,IAAMc,YAAY;UAAA,oBACNC,EADM,QACoBC,KADpB,EAC2B;QAA3BL,SAA2B,QAA3BA,SAA2B;QAAhBM,KAAgB,QAAhBA,KAAgB;;QACrC,OAAOA,MAAM5C,IAAb,KAAsB,QAA1B,EAAoC,OAAO6C,MAAM3C,KAAN,CAAY,iDAAZ,CAAP;QAChC0C,MAAM5C,IAAN,KAAe,QAAnB,EAA6B,OAAO6C,MAAM3C,KAAN,CAAY,gCAAZ,CAAP;QACvBkB,QAAQuB,MAAMG,OAAN,CAAcC,KAAd,CAAoBC,QAApB,CAA6BJ,MAAM5C,IAAnC,CAAd;QACI,CAACpB,KAAKU,QAAL,CAAc8B,KAAd,CAAL,EAA2B,OAAOyB,MAAM3C,KAAN,QAAgB0C,MAAM5C,IAAtB,oCAAP;QACvBqC,OAAOC,SAAP,CAAJ,EAAuB;UACjB,OAAOM,MAAM7B,IAAb,KAAsB,QAA1B,EAAoC,OAAO8B,MAAM3C,KAAN,CAAY,iDAAZ,CAAP;SACjCI,KAAH,IAAY,IAAIE,UAAJ,CAAe;aACpBkC,EADoB;cAEnBE,MAAM5C,IAFa;cAGnB4C,MAAM7B,IAHa;oBAAA;iBAKhB6B,MAAML;OALL,CAAZ;;QAQEC,SAASF,SAAT,CAAJ,EAAyB;SACpB/B,OAAH,IAAc,IAAIC,UAAJ,CAAe;aACtBmB,MADsB;cAErBiB,MAAM5C,IAFe;cAGrB,QAHqB;oBAAA;iBAKlB4C,MAAMjB;OALH,CAAd;;GAjBY;kBAAA,4BA0BEe,EA1BF,SA0B4BC,KA1B5B,EA0BmC;QAA3BL,SAA2B,SAA3BA,SAA2B;QAAhBM,KAAgB,SAAhBA,KAAgB;;QAC3CxB,QAAQuB,MAAMG,OAAN,CAAcC,KAAd,CAAoBC,QAApB,CAA6BJ,MAAM5C,IAAnC,CAAd;QACI,CAACpB,KAAKU,QAAL,CAAc8B,KAAd,CAAL,EAA2B,OAAOyB,MAAM3C,KAAN,QAAgB0C,MAAM5C,IAAtB,oCAAP;QACvBqC,OAAOC,SAAP,CAAJ,EAAuB;SAClBhC,KAAH,EAAU2C,MAAV,CAAiB;aACVP,EADU;cAETE,MAAM5C,IAFG;cAGT4C,MAAM7B,IAHG;oBAAA;iBAKN6B,MAAML;OALjB;;QAQEC,SAASF,SAAT,CAAJ,EAAyB;SACpB/B,OAAH,EAAY0C,MAAZ,CAAmB;aACZtB,MADY;cAEXiB,MAAM5C,IAFK;cAGX,QAHW;oBAAA;iBAKR4C,MAAMjB,MAAN,IAAgB;OAL3B;;GAvCY;QAAA,kBAgDRe,EAhDQ,SAgDW;QAAbJ,SAAa,SAAbA,SAAa;;QACrBD,OAAOC,SAAP,CAAJ,EAAuB;SAClBhC,KAAH,EAAU4C,OAAV;aACOR,GAAGpC,KAAH,CAAP;;QAEEkC,SAASF,SAAT,CAAJ,EAAyB;SACpB/B,OAAH,EAAY2C,OAAZ;aACOR,GAAGnC,OAAH,CAAP;;;CAvDN;;AA4DA,YAAe;SAAA,mBACJ4C,GADI,EACC;WACLA,GAAP;QACIV,SAAJ,CAAc,aAAd,EAA6BA,SAA7B;;CAHJ;;;;;;"}